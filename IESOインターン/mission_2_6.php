<html>
<head>好きな曲を書いてください</head><br/> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="expires" content="0" />
<?php  //名前とコメントを保存する
  //ファイルがなかった場合新規作成する
	$filename='mission_2-2.txt';
		if(file_exists($filename) == false){
			touch($filename);
		}
  	//更新した際などに実行されないように条件分岐させる
	if(!empty($_POST['name']) && !empty($_POST['comment']) && empty($_POST['edit']) && !empty($_POST['password'])){
				//echo "f1に入れている";
				$f1 = $_POST['name'];
				$f2 = $_POST['comment'];
				$password = $_POST['password'];

				//txtファイルを配列に格納
				$char_array = file($filename);
				//配列数をカウントする
				$cnt = count($char_array)+1;

				//時間の取得
				date_default_timezone_set('Asia/Tokyo');//世界基準表示から東京表示に直す
				$time = date("Y/m/d H:i:s",time());
				//ファイルの文字と入力された文字を連結させる
				$corrent = "";
				$corrent = $corrent.$cnt."<>".$f1."<>".$f2."<>".$time."<>".$password."\n";
				//まずはfopenのaモード（追記モード）でファイルを開く
				$fp = fopen($filename, 'a+');

				//fopenで開いたテキストファイルに受け取った値を書き込む
				fwrite($fp,$corrent);

				//fopenで開いたテキストファイルを閉じる
				fclose($fp);
     		}else if(!empty($_POST['name']) && !empty($_POST['comment']) && empty($_POST['password'])){
     			echo "パスワードを入力してください";
     		}
?>

<?php //password判定
    if(!empty($_POST['key'])){
	$filename='mission_2-2.txt';
	$key = $_POST['key'];
	$delete = $_POST['delete'];
	$edit =$_POST['number'];
	$delete_num = $delete - 1;
	$editnumber = $edit-1;
	//echo "$key";
	//txtファイルを配列に格納
 	$arrayList = file($filename,FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
		if(!empty($delete)){
					$serch = $arrayList[$delete_num];
					//echo "$serch";
					$char = explode("<>",$serch);
							if($char[4] === $key){
									$match = match;
 										}else{
											echo "パスワードが違います";
											}
				}else if(!empty($edit)){
					$serch = $arrayList[$editnumber];
					//echo "$serch";
					$char = explode("<>",$serch);
								if($char[4] === $key){
										$match = match;
											}else{
												echo "パスワードが違います";
												}
							}
	   			}
?>

<?php  //削除をする
	//echo "$match";
	//入力があった場合のみ
	if(!empty($_POST['delete']) &&  !empty($match)){
			//echo "a";
			$i=1;
			$f3 = $_POST['delete'];
			$filename='mission_2-2.txt';
			$password = $_POST['password'];
			//txtファイルを配列に格納
 			$arrayList = file($filename,FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

			//まずはfopenのwモードファイルを新規作成
			$fp = fopen($filename, 'w');
			//fopenで開いたテキストファイルを閉じる
			fclose($fp);

				foreach($arrayList as $arrayList_num){
						$char = explode("<>", $arrayList_num);
					
								//対象番号でない時のみ保存
								if($char[0] != $f3){
									//文字を連結
										$corrent = $i."<>".$char[1]."<>".$char[2]."<>".$char[3]."<>".$char[4]."\n";
										$i++;
	   								//fopenのaモード（追記モード）でファイルを開く
										$fp = fopen($filename, 'a+');

									//fopenで開いたテキストファイルに受け取った値を書き込む
										fwrite($fp,$corrent);

									//fopenで開いたテキストファイルを閉じる
										fclose($fp);


								}
						}
   				 
		}else if(empty($_POST['password']) && !empty($_POST['delete'])){
			echo "パスワードを入力してください";
  }	
?>


<?php //編集番号で指定された名前とコメントを取得
	if(!empty($_POST['number']) && !empty($match)){
		$f4=$_POST['number'];
		$password = $_POST['key'];
		//ファイル名を取得
		$filename='mission_2-2.txt';

		//txtファイルを配列に格納
 		$arrayList = file($filename,FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
			
			foreach($arrayList as $arrayList_num){
				$char = explode("<>", $arrayList_num);
					if($char[4] == $password){
					 //echo "if1に入れてる";
					 //echo "$char[0] == $f4";
						if($char[0] == $f4){
								$data1=$char[1];
								$data2=$char[2];
								$key_re = $char[4];
								$edit_num = $f4;
								//echo "if2に入れてる";
							}
					}
				}
		}else if(empty($_POST['key']) && !empty($_POST['number']) ){
			echo "パスワードを入力してください";
	}
?>


<?php    //編集する名前とコメントを保存
	//echo $_POST['edit'];
	if(!empty($_POST['edit']) ){
		//echo "編集モードになっている";
		$i=1;
		$f1 = $_POST['name'];
		$f2 = $_POST['comment'];
		$f4=$_POST['number1'];
		$password = $_POST['password'];
		$filename='mission_2-2.txt';

		//txtファイルを配列に格納
 		$arrayList = file($filename,FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);

		//fopenのwモードファイルを新規作成
		$fp = fopen($filename, 'w');
		//fopenで開いたテキストファイルを閉じる
		fclose($fp);

			foreach($arrayList as $arrayList_num){
					$char = explode("<>", $arrayList_num);

						//対象番号で条件分けして保存
						if($char[0] == $f4){
						//fopenのaモード（追記モード）でファイルを開く
						$fp = fopen($filename, 'a+');

						//文字を連結
	 					$corrent = $i."<>".$f1."<>".$f2."<>".$char[3]."<>".$password."\n";
						$i++;

						//fopenで開いたテキストファイルに受け取った値を書き込む
						fwrite($fp,$corrent);
						fclose($fp);

						}else{

						//fopenのaモード（追記モード）でファイルを開く
						$fp = fopen($filename, 'a+');
						//文字を連結
	 					$corrent = $i."<>".$char[1]."<>".$char[2]."<>".$char[3]."\n";
	 					$i++;
						//fopenで開いたテキストファイルに受け取った値を書き込む
						fwrite($fp,$corrent);
						//fopenで開いたテキストファイルを閉じる
        					fclose($fp); 
						}
    				}

  		

	}
	

?>


<body>
<title>エフェクターブログ</title>
      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               
	<form  action="mission_2_6.php" method = "post">
	<head>名前</head><br/>
	<input type="text" name="name" value = "<?php echo $data1; ?>"><br/>

	<head>コメント</head><br/>
	<input type ="text" name="comment" value = "<?php echo $data2; ?>"><br/>
	<input type = "hidden" name = "edit" value = "<?php echo $edit_num; ?>">
	<input type="hidden" name="number1" value = "<?php echo $f4; ?>" >
	
	<head>パスワード</head><br/>
	<input type="text" name="password" value ="<?php echo $key_re; ?>" ><br/>
	<input type="submit" value="送信"><br/>
	</form>

	<form  action="mission_2_6.php" method = "post">
	<head>削除対象番号</head><br/>
	<input type="text" name="delete"><br/>
	<head>パスワード</head><br/>
	<input type="text" name="key"><br/>
	<input type="submit" value="削除"><br/>
	</form>

	<form  action="mission_2_6.php" method = "post">
	<head>編集対象番号</head><br/>
	<input type="text" name="number"><br/>
	<head>パスワード</head><br/>
	<input type="text" name="key"><br/>
	<input type="submit" value="編集番号指定"><br/>
	</form>
</body>


<?php  //表示させるプログラム

	//1行ごとに配列を格納
	$arrayList = file('mission_2-2.txt');
	foreach($arrayList as $arrayList_num){
			$char = explode("<>", $arrayList_num);
			echo '<br>'.$char[0].".".$char[1].'<br>'.$char[2].'<br>'.$char[3].'<br>';

			}

?>
</body>
</html>